"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const web_service_interface_1 = require("@sirensolutions/web-service-interface");
const axios_1 = require("axios");
const cryptoRegexPatterns = {
    'BTC': '^(bc1|[13])[a-zA-HJ-NP-Z0-9]{25,39}$',
    'ETH': '^(?:0x)?[a-fA-F0-9]{40,42}$',
    'XRP': '^r[0-9a-zA-Z]{24,34}$',
    'BNB': '^bnb[0-9a-zA-Z]{38}$',
    'ADA': '^Ae2tdPwUPEYy{44}$',
    'SOL': '^So[1-9][0-9a-zA-Z]{48}$',
    'DOGE': '^D[0-9a-fA-F]{32}$',
    'TRX': '^T[0-9a-fA-F]{33}$',
    'LTC': '^L[a-km-zA-HJ-NP-Z1-9]{26,33}$',
    'DOT': '^1[a-zA-Z0-9]{31}$',
    'LINK': '^0x[a-fA-F0-9]{40}$',
    'XLM': '^G[A-Z0-9]{55}$',
    'XMR': '^4[0-9A-Za-z]{94}$',
    'ATOM': '^cosmos1[a-z0-9]{38}$',
};
class AddressTransactions extends web_service_interface_1.ServiceDefinition {
    constructor() {
        super(...arguments);
        this.name = 'address_transactions';
        this.inputSchema = {
            address: { type: 'text', required: true },
            asset: { type: 'text', required: false },
            direction: { type: 'text', required: false },
            page: { type: 'text', required: false },
            page_limit: { type: 'float', required: false },
            cluster: { type: 'text', required: false },
            cluster_counterparty: { type: 'text', required: false },
            cluster_startTime: { type: 'text', required: false },
            cluster_endTime: { type: 'text', required: false },
        };
        this.outputConfiguration = {
            transaction: {
                details: {
                    'blockTimestamp': 'date',
                    'blockHeight': 'long',
                    'exchangeRate': 'long',
                    'fee': 'long',
                    traces: {
                        inputs: {
                            'amount': 'long'
                        },
                        outputs: {
                            'amount': 'long'
                        }
                    }
                }
            },
            pagination: {}
        };
    }
    inferAssetType(address) {
        return Object.keys(cryptoRegexPatterns).filter(asset => {
            return new RegExp(cryptoRegexPatterns[asset]).test(address);
        });
    }
    async invoke(inputs) {
        const matchedAssets = inputs.asset ? [inputs.asset] : this.inferAssetType(inputs.address);
        let overallResults = [];
        let overallNextPage = '';
        let overallTruncated = false;
        for (const asset of matchedAssets) {
            let base_url = inputs.cluster
                ? `https://iapi.chainalysis.com/clusters/${inputs.address}/${asset}/transactions?size=100`
                : `https://iapi.chainalysis.com/addresses/${inputs.address}/${asset}/transactions?size=100&direction=${inputs.direction}`;
            if (inputs.cluster_startTime) {
                base_url = base_url + `&startTime=${inputs.cluster_startTime}`;
            }
            if (inputs.cluster_endTime) {
                base_url = base_url + `&endTime=${inputs.cluster_endTime}`;
            }
            if (inputs.cluster_counterparty) {
                base_url = base_url + `&counterparty=${inputs.cluster_counterparty}`;
            }
            let transaction_url = `${base_url}`;
            if (inputs.page) {
                transaction_url = transaction_url + `&page=${inputs.page}`;
            }
            let pagesFetched = 0;
            const pageLimit = inputs.page_limit ? (inputs.page_limit === 0 ? Number.MAX_SAFE_INTEGER : inputs.page_limit) : Number.MAX_SAFE_INTEGER;
            const transaction_config = {
                method: 'get',
                url: transaction_url,
                headers: {
                    'Accept': 'application/json',
                    'token': this.config.token
                }
            };
            const transaction_response = await axios_1.default(transaction_config).catch(err => Promise.reject(err.response && err.response.status < 500 ? new web_service_interface_1.WebServiceError(err.response.data) : err));
            if (transaction_response.data.nextPage != null) {
                let page = transaction_response.data.nextPage;
                let lastResult = { nextPage: '' };
                do {
                    let sub_url = `${base_url}` + `&page=${page}`;
                    const sub_config = {
                        method: 'get',
                        url: sub_url,
                        headers: {
                            'Accept': 'application/json',
                            'token': this.config.token
                        }
                    };
                    const sub_response = await axios_1.default(sub_config).catch(err => Promise.reject(err.response && err.response.status < 500 ? new web_service_interface_1.WebServiceError(err.response.data) : err));
                    lastResult = sub_response.data;
                    transaction_response.data.items.push.apply(transaction_response.data.items, sub_response.data.items);
                    page = lastResult.nextPage;
                    pagesFetched += 1;
                } while (lastResult.nextPage !== null && pagesFetched < pageLimit);
                if (lastResult.nextPage !== null) {
                    overallTruncated = true;
                    overallNextPage = lastResult.nextPage;
                }
            }
            for (let y = 0; y < transaction_response.data.items.length; y++) {
                let hash_url = `https://iapi.chainalysis.com/transactions/${transaction_response.data.items[y].transactionHash}/${asset}/details`;
                const hash_config = {
                    method: 'get',
                    url: hash_url,
                    headers: {
                        'Accept': 'application/json',
                        'token': this.config.token
                    }
                };
                const hash_response = await axios_1.default(hash_config).catch(err => Promise.reject(err.response && err.response.status < 500 ? new web_service_interface_1.WebServiceError(err.response.data) : err));
                Object.assign(transaction_response.data.items[y], {
                    details: hash_response.data,
                    direction: inputs.direction,
                    id: asset + ':' + transaction_response.data.items[y].transactionHash,
                    sirenDenormInputAddress: [],
                    sirenDenormOutputAddress: []
                });
                try {
                    for (let a = 0; a < hash_response.data.traces.length; a++) {
                        for (let b = 0; b < hash_response.data.traces[a].inputs.length; b++) {
                            transaction_response.data.items[y].sirenDenormInputAddress.push(asset + ':' + hash_response.data.traces[a].inputs[b].address);
                        }
                        for (let c = 0; c < hash_response.data.traces[a].outputs.length; c++) {
                            transaction_response.data.items[y].sirenDenormOutputAddress.push(asset + ':' + hash_response.data.traces[a].outputs[c].address);
                        }
                    }
                }
                catch (error) { /* error handling can be done here if required */ }
            }
            overallResults.push.apply(overallResults, transaction_response.data.items);
        }
        return {
            transaction: overallResults,
            pagination: [{
                    totalresults: overallResults.length,
                    nextPage: overallNextPage
                }]
        };
    }
}
exports.default = AddressTransactions;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9BZGRyZXNzVHJhbnNhY3Rpb25zLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsaUZBQStJO0FBQy9JLGlDQUFpRTtBQUVqRSxNQUFNLG1CQUFtQixHQUFHO0lBQ3hCLEtBQUssRUFBRSxzQ0FBc0M7SUFDN0MsS0FBSyxFQUFFLDZCQUE2QjtJQUNwQyxLQUFLLEVBQUUsdUJBQXVCO0lBQzlCLEtBQUssRUFBRSxzQkFBc0I7SUFDN0IsS0FBSyxFQUFFLG9CQUFvQjtJQUMzQixLQUFLLEVBQUUsMEJBQTBCO0lBQ2pDLE1BQU0sRUFBRSxvQkFBb0I7SUFDNUIsS0FBSyxFQUFFLG9CQUFvQjtJQUMzQixLQUFLLEVBQUUsZ0NBQWdDO0lBQ3ZDLEtBQUssRUFBRSxvQkFBb0I7SUFDM0IsTUFBTSxFQUFFLHFCQUFxQjtJQUM3QixLQUFLLEVBQUUsaUJBQWlCO0lBQ3hCLEtBQUssRUFBRSxvQkFBb0I7SUFDM0IsTUFBTSxFQUFFLHVCQUF1QjtDQUVsQyxDQUFDO0FBRUYsTUFBcUIsbUJBQW9CLFNBQVEseUNBQWlCO0lBQWxFOztRQUNhLFNBQUksR0FBRyxzQkFBc0IsQ0FBQztRQUM5QixnQkFBVyxHQUFnQjtZQUNoQyxPQUFPLEVBQUUsRUFBRSxJQUFJLEVBQUUsTUFBTSxFQUFFLFFBQVEsRUFBRSxJQUFJLEVBQUU7WUFDekMsS0FBSyxFQUFFLEVBQUUsSUFBSSxFQUFFLE1BQU0sRUFBRSxRQUFRLEVBQUUsS0FBSyxFQUFFO1lBQ3hDLFNBQVMsRUFBRSxFQUFFLElBQUksRUFBRSxNQUFNLEVBQUUsUUFBUSxFQUFFLEtBQUssRUFBRTtZQUM1QyxJQUFJLEVBQUUsRUFBRSxJQUFJLEVBQUUsTUFBTSxFQUFFLFFBQVEsRUFBRSxLQUFLLEVBQUU7WUFDdkMsVUFBVSxFQUFFLEVBQUUsSUFBSSxFQUFFLE9BQU8sRUFBRSxRQUFRLEVBQUUsS0FBSyxFQUFFO1lBQzlDLE9BQU8sRUFBRSxFQUFFLElBQUksRUFBRSxNQUFNLEVBQUUsUUFBUSxFQUFF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Q0FBQyxDQUFDLHVCQUF1QixDQUFDLElBQUksQ0FBQyxLQUFLLEdBQUcsR0FBRyxHQUFHLGFBQWEsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQzt5QkFDakk7d0JBQ0QsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLGFBQWEsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxNQUFNLEVBQUUsQ0FBQyxFQUFFLEVBQUU7NEJBQ2xFLG9CQUFvQixDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsd0JBQXdCLENBQUMsSUFBSSxDQUFDLEtBQUssR0FBRyxHQUFHLEdBQUcsYUFBYSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDO3lCQUNuSTtxQkFDSjtpQkFDSjtnQkFBQyxPQUFPLEtBQUssRUFBRSxFQUFFLGlEQUFpRCxFQUFFO2FBQ3hFO1lBQ0QsY0FBYyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsY0FBYyxFQUFFLG9CQUFvQixDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztTQUM5RTtRQUVELE9BQU87WUFDSCxXQUFXLEVBQUUsY0FBYztZQUMzQixVQUFVLEVBQUUsQ0FBQztvQkFDVCxZQUFZLEVBQUUsY0FBYyxDQUFDLE1BQU07b0JBQ25DLFFBQVEsRUFBRSxlQUFlO2lCQUM1QixDQUFDO1NBQ0wsQ0FBQztJQUNOLENBQUM7Q0FDSjtBQWxKRCxzQ0FrSkMiLCJmaWxlIjoic3JjL0FkZHJlc3NUcmFuc2FjdGlvbnMuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBEYXRhSW5kZXhSZXN1bHRzLCBJbnB1dFNjaGVtYSwgT3V0cHV0Q29uZmlndXJhdGlvbiwgU2VydmljZURlZmluaXRpb24sIFdlYlNlcnZpY2VFcnJvciB9IGZyb20gJ0BzaXJlbnNvbHV0aW9ucy93ZWItc2VydmljZS1pbnRlcmZhY2UnO1xyXG5pbXBvcnQgYXhpb3MsIHsgQXhpb3NSZXF1ZXN0Q29uZmlnLCBBeGlvc1Jlc3BvbnNlIH0gZnJvbSAnYXhpb3MnO1xyXG5cclxuY29uc3QgY3J5cHRvUmVnZXhQYXR0ZXJucyA9IHtcclxuICAgICdCVEMnOiAnXihiYzF8WzEzXSlbYS16QS1ISi1OUC1aMC05XXsyNSwzOX0kJywgLy8gQml0Y29pbiAoQlRDKSBpbmNsdWRpbmcgYmVjaDMyIGFkZHJlc3Nlc1xyXG4gICAgJ0VUSCc6ICdeKD86MHgpP1thLWZBLUYwLTldezQwLDQyfSQnLCAvLyBFdGhlcmV1bVxyXG4gICAgJ1hSUCc6ICdeclswLTlhLXpBLVpdezI0LDM0fSQnLCAvLyBSaXBwbGVcclxuICAgICdCTkInOiAnXmJuYlswLTlhLXpBLVpdezM4fSQnLCAvLyBCaW5hbmNlIENvaW5cclxuICAgICdBREEnOiAnXkFlMnRkUHdVUEVZeXs0NH0kJywgLy8gQ2FyZGFub1xyXG4gICAgJ1NPTCc6ICdeU29bMS05XVswLTlhLXpBLVpdezQ4fSQnLCAvLyBTb2xhbmFcclxuICAgICdET0dFJzogJ15EWzAtOWEtZkEtRl17MzJ9JCcsIC8vIERvZ2Vjb2luXHJcbiAgICAnVFJYJzogJ15UWzAtOWEtZkEtRl17MzN9JCcsIC8vIFRyb25cclxuICAgICdMVEMnOiAnXkxbYS1rbS16QS1ISi1OUC1aMS05XXsyNiwzM30kJywgLy8gTGl0ZWNvaW5cclxuICAgICdET1QnOiAnXjFbYS16QS1aMC05XXszMX0kJywgLy8gUG9sa2Fkb3RcclxuICAgICdMSU5LJzogJ14weFthLWZBLUYwLTldezQwfSQnLCAvLyBDaGFpbmxpbmtcclxuICAgICdYTE0nOiAnXkdbQS1aMC05XXs1NX0kJywgLy8gU3RlbGxhciBMdW1lbnNcclxuICAgICdYTVInOiAnXjRbMC05QS1aYS16XXs5NH0kJywgLy8gTW9uZXJvXHJcbiAgICAnQVRPTSc6ICdeY29zbW9zMVthLXowLTldezM4fSQnLCAvLyBDb3Ntb3NcclxuICAgIC8vIEFkZCBtb3JlIHBhdHRlcm5zIGhlcmUgZm9yIG90aGVyIGNyeXB0b2N1cnJlbmNpZXNcclxufTtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEFkZHJlc3NUcmFuc2FjdGlvbnMgZXh0ZW5kcyBTZXJ2aWNlRGVmaW5pdGlvbiB7XHJcbiAgICByZWFkb25seSBuYW1lID0gJ2FkZHJlc3NfdHJhbnNhY3Rpb25zJztcclxuICAgIHJlYWRvbmx5IGlucHV0U2NoZW1hOiBJbnB1dFNjaGVtYSA9IHtcclxuICAgICAgICBhZGRyZXNzOiB7IHR5cGU6ICd0ZXh0JywgcmVxdWlyZWQ6IHRydWUgfSxcclxuICAgICAgICBhc3NldDogeyB0eXBlOiAndGV4dCcsIHJlcXVpcmVkOiBmYWxzZSB9LFxyXG4gICAgICAgIGRpcmVjdGlvbjogeyB0eXBlOiAndGV4dCcsIHJlcXVpcmVkOiBmYWxzZSB9LFxyXG4gICAgICAgIHBhZ2U6IHsgdHlwZTogJ3RleHQnLCByZXF1aXJlZDogZmFsc2UgfSxcclxuICAgICAgICBwYWdlX2xpbWl0OiB7IHR5cGU6ICdmbG9hdCcsIHJlcXVpcmVkOiBmYWxzZSB9LFxyXG4gICAgICAgIGNsdXN0ZXI6IHsgdHlwZTogJ3RleHQnLCByZXF1aXJlZDogZmFsc2UgfSxcclxuICAgICAgICBjbHVzdGVyX2NvdW50ZXJwYXJ0eTogeyB0eXBlOiAndGV4dCcsIHJlcXVpcmVkOiBmYWxzZSB9LFxyXG4gICAgICAgIGNsdXN0ZXJfc3RhcnRUaW1lOiB7IHR5cGU6ICd0ZXh0JywgcmVxdWlyZWQ6IGZhbHNlIH0sXHJcbiAgICAgICAgY2x1c3Rlcl9lbmRUaW1lOiB7IHR5cGU6ICd0ZXh0JywgcmVxdWlyZWQ6IGZhbHNlIH0sXHJcbiAgICB9O1xyXG4gICAgcmVhZG9ubHkgb3V0cHV0Q29uZmlndXJhdGlvbjogT3V0cHV0Q29uZmlndXJhdGlvbiA9IHtcclxuICAgICAgICB0cmFuc2FjdGlvbjoge1xyXG4gICAgICAgICAgICBkZXRhaWxzOiB7XHJcbiAgICAgICAgICAgICAgICAnYmxvY2tUaW1lc3RhbXAnOiAnZGF0ZScsXHJcbiAgICAgICAgICAgICAgICAnYmxvY2tIZWlnaHQnOiAnbG9uZycsXHJcbiAgICAgICAgICAgICAgICAnZXhjaGFuZ2VSYXRlJzogJ2xvbmcnLFxyXG4gICAgICAgICAgICAgICAgJ2ZlZSc6ICdsb25nJyxcclxuICAgICAgICAgICAgICAgIHRyYWNlczoge1xyXG4gICAgICAgICAgICAgICAgICAgIGlucHV0czoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAnYW1vdW50JzogJ2xvbmcnXHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICBvdXRwdXRzOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICdhbW91bnQnOiAnbG9uZydcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9LFxyXG4gICAgICAgIHBhZ2luYXRpb246IHt9XHJcbiAgICB9O1xyXG5cclxuICAgIHByaXZhdGUgaW5mZXJBc3NldFR5cGUoYWRkcmVzczogc3RyaW5nKTogc3RyaW5nW10ge1xyXG4gICAgICAgIHJldHVybiBPYmplY3Qua2V5cyhjcnlwdG9SZWdleFBhdHRlcm5zKS5maWx0ZXIoYXNzZXQgPT4ge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFJlZ0V4cChjcnlwdG9SZWdleFBhdHRlcm5zW2Fzc2V0XSkudGVzdChhZGRyZXNzKTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBhc3luYyBpbnZva2UoaW5wdXRzOiB7XHJcbiAgICAgICAgYWRkcmVzczogc3RyaW5nLFxyXG4gICAgICAgIGFzc2V0Pzogc3RyaW5nLFxyXG4gICAgICAgIGRpcmVjdGlvbjogc3RyaW5nLFxyXG4gICAgICAgIHBhZ2U/OiBzdHJpbmcsXHJcbiAgICAgICAgcGFnZV9saW1pdD86IG51bWJlcixcclxuICAgICAgICBjbHVzdGVyPzogc3RyaW5nLFxyXG4gICAgICAgIGNsdXN0ZXJfY291bnRlcnBhcnR5Pzogc3RyaW5nLFxyXG4gICAgICAgIGNsdXN0ZXJfc3RhcnRUaW1lPzogc3RyaW5nLFxyXG4gICAgICAgIGNsdXN0ZXJfZW5kVGltZT86IHN0cmluZ1xyXG4gICAgfSk6IFByb21pc2U8RGF0YUluZGV4UmVzdWx0cz4ge1xyXG4gICAgICAgIGNvbnN0IG1hdGNoZWRBc3NldHMgPSBpbnB1dHMuYXNzZXQgPyBbaW5wdXRzLmFzc2V0XSA6IHRoaXMuaW5mZXJBc3NldFR5cGUoaW5wdXRzLmFkZHJlc3MpO1xyXG4gICAgICAgIGxldCBvdmVyYWxsUmVzdWx0cyA9IFtdO1xyXG4gICAgICAgIGxldCBvdmVyYWxsTmV4dFBhZ2UgPSAnJztcclxuICAgICAgICBsZXQgb3ZlcmFsbFRydW5jYXRlZCA9IGZhbHNlO1xyXG5cclxuICAgICAgICBmb3IgKGNvbnN0IGFzc2V0IG9mIG1hdGNoZWRBc3NldHMpIHtcclxuICAgICAgICAgICAgbGV0IGJhc2VfdXJsID0gaW5wdXRzLmNsdXN0ZXIgXHJcbiAgICAgICAgICAgICAgICA/IGBodHRwczovL2lhcGkuY2hhaW5hbHlzaXMuY29tL2NsdXN0ZXJzLyR7aW5wdXRzLmFkZHJlc3N9LyR7YXNzZXR9L3RyYW5zYWN0aW9ucz9zaXplPTEwMGBcclxuICAgICAgICAgICAgICAgIDogYGh0dHBzOi8vaWFwaS5jaGFpbmFseXNpcy5jb20vYWRkcmVzc2VzLyR7aW5wdXRzLmFkZHJlc3N9LyR7YXNzZXR9L3RyYW5zYWN0aW9ucz9zaXplPTEwMCZkaXJlY3Rpb249JHtpbnB1dHMuZGlyZWN0aW9ufWA7XHJcbiAgICAgICAgICAgIGlmIChpbnB1dHMuY2x1c3Rlcl9zdGFydFRpbWUpIHtiYXNlX3VybCA9IGJhc2VfdXJsICsgYCZzdGFydFRpbWU9JHtpbnB1dHMuY2x1c3Rlcl9zdGFydFRpbWV9YCB9XHJcbiAgICAgICAgICAgIGlmIChpbnB1dHMuY2x1c3Rlcl9lbmRUaW1lKSB7IGJhc2VfdXJsID0gYmFzZV91cmwgKyBgJmVuZFRpbWU9JHtpbnB1dHMuY2x1c3Rlcl9lbmRUaW1lfWAgfVxyXG4gICAgICAgICAgICBpZiAoaW5wdXRzLmNsdXN0ZXJfY291bnRlcnBhcnR5KSB7IGJhc2VfdXJsID0gYmFzZV91cmwgKyBgJmNvdW50ZXJwYXJ0eT0ke2lucHV0cy5jbHVzdGVyX2NvdW50ZXJwYXJ0eX1gIH1cclxuXHJcbiAgICAgICAgICAgIGxldCB0cmFuc2FjdGlvbl91cmwgPSBgJHtiYXNlX3VybH1gXHJcbiAgICAgICAgICAgIGlmIChpbnB1dHMucGFnZSkge1xyXG4gICAgICAgICAgICAgICAgdHJhbnNhY3Rpb25fdXJsID0gdHJhbnNhY3Rpb25fdXJsICsgYCZwYWdlPSR7aW5wdXRzLnBhZ2V9YDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBsZXQgcGFnZXNGZXRjaGVkID0gMDtcclxuICAgICAgICAgICAgY29uc3QgcGFnZUxpbWl0ID0gaW5wdXRzLnBhZ2VfbGltaXQgPyAoaW5wdXRzLnBhZ2VfbGltaXQgPT09IDAgPyBOdW1iZXIuTUFYX1NBRkVfSU5URUdFUiA6IGlucHV0cy5wYWdlX2xpbWl0KSA6IE51bWJlci5NQVhfU0FGRV9JTlRFR0VSO1xyXG5cclxuICAgICAgICAgICAgY29uc3QgdHJhbnNhY3Rpb25fY29uZmlnOiBBeGlvc1JlcXVlc3RDb25maWcgPSB7XHJcbiAgICAgICAgICAgICAgICBtZXRob2Q6ICdnZXQnLFxyXG4gICAgICAgICAgICAgICAgdXJsOiB0cmFuc2FjdGlvbl91cmwsXHJcbiAgICAgICAgICAgICAgICBoZWFkZXJzOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgJ0FjY2VwdCc6ICdhcHBsaWNhdGlvbi9qc29uJyxcclxuICAgICAgICAgICAgICAgICAgICAndG9rZW4nOiB0aGlzLmNvbmZpZy50b2tlblxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICBjb25zdCB0cmFuc2FjdGlvbl9yZXNwb25zZTogQXhpb3NSZXNwb25zZSA9IGF3YWl0IGF4aW9zKHRyYW5zYWN0aW9uX2NvbmZpZykuY2F0Y2goZXJyID0+IFByb21pc2UucmVqZWN0KGVyci5yZXNwb25zZSAmJiBlcnIucmVzcG9uc2Uuc3RhdHVzIDwgNTAwID8gbmV3IFdlYlNlcnZpY2VFcnJvcihlcnIucmVzcG9uc2UuZGF0YSkgOiBlcnIpKTtcclxuXHJcbiAgICAgICAgICAgIGlmICh0cmFuc2FjdGlvbl9yZXNwb25zZS5kYXRhLm5leHRQYWdlICE9IG51bGwpIHtcclxuICAgICAgICAgICAgICAgIGxldCBwYWdlID0gdHJhbnNhY3Rpb25fcmVzcG9uc2UuZGF0YS5uZXh0UGFnZTtcclxuICAgICAgICAgICAgICAgIGxldCBsYXN0UmVzdWx0ID0geyBuZXh0UGFnZTogJycgfTtcclxuICAgICAgICAgICAgICAgIGRvIHtcclxuICAgICAgICAgICAgICAgICAgICBsZXQgc3ViX3VybCA9IGAke2Jhc2VfdXJsfWAgKyBgJnBhZ2U9JHtwYWdlfWA7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3ViX2NvbmZpZzogQXhpb3NSZXF1ZXN0Q29uZmlnID0ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBtZXRob2Q6ICdnZXQnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB1cmw6IHN1Yl91cmwsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGhlYWRlcnM6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICdBY2NlcHQnOiAnYXBwbGljYXRpb24vanNvbicsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAndG9rZW4nOiB0aGlzLmNvbmZpZy50b2tlblxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBzdWJfcmVzcG9uc2U6IEF4aW9zUmVzcG9uc2UgPSBhd2FpdCBheGlvcyhzdWJfY29uZmlnKS5jYXRjaChlcnIgPT4gUHJvbWlzZS5yZWplY3QoZXJyLnJlc3BvbnNlICYmIGVyci5yZXNwb25zZS5zdGF0dXMgPCA1MDAgPyBuZXcgV2ViU2VydmljZUVycm9yKGVyci5yZXNwb25zZS5kYXRhKSA6IGVycikpO1xyXG4gICAgICAgICAgICAgICAgICAgIGxhc3RSZXN1bHQgPSBzdWJfcmVzcG9uc2UuZGF0YTtcclxuICAgICAgICAgICAgICAgICAgICB0cmFuc2FjdGlvbl9yZXNwb25zZS5kYXRhLml0ZW1zLnB1c2guYXBwbHkodHJhbnNhY3Rpb25fcmVzcG9uc2UuZGF0YS5pdGVtcywgc3ViX3Jlc3BvbnNlLmRhdGEuaXRlbXMpO1xyXG4gICAgICAgICAgICAgICAgICAgIHBhZ2UgPSBsYXN0UmVzdWx0Lm5leHRQYWdlO1xyXG4gICAgICAgICAgICAgICAgICAgIHBhZ2VzRmV0Y2hlZCArPSAxO1xyXG4gICAgICAgICAgICAgICAgfSB3aGlsZSAobGFzdFJlc3VsdC5uZXh0UGFnZSAhPT0gbnVsbCAmJiBwYWdlc0ZldGNoZWQgPCBwYWdlTGltaXQpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGxhc3RSZXN1bHQubmV4dFBhZ2UgIT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgICAgICBvdmVyYWxsVHJ1bmNhdGVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICBvdmVyYWxsTmV4dFBhZ2UgPSBsYXN0UmVzdWx0Lm5leHRQYWdlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBmb3IgKGxldCB5ID0gMDsgeSA8IHRyYW5zYWN0aW9uX3Jlc3BvbnNlLmRhdGEuaXRlbXMubGVuZ3RoOyB5KyspIHtcclxuICAgICAgICAgICAgICAgIGxldCBoYXNoX3VybCA9IGBodHRwczovL2lhcGkuY2hhaW5hbHlzaXMuY29tL3RyYW5zYWN0aW9ucy8ke3RyYW5zYWN0aW9uX3Jlc3BvbnNlLmRhdGEuaXRlbXNbeV0udHJhbnNhY3Rpb25IYXNofS8ke2Fzc2V0fS9kZXRhaWxzYDtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGhhc2hfY29uZmlnOiBBeGlvc1JlcXVlc3RDb25maWcgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiAnZ2V0JyxcclxuICAgICAgICAgICAgICAgICAgICB1cmw6IGhhc2hfdXJsLFxyXG4gICAgICAgICAgICAgICAgICAgIGhlYWRlcnM6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJ0FjY2VwdCc6ICdhcHBsaWNhdGlvbi9qc29uJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgJ3Rva2VuJzogdGhpcy5jb25maWcudG9rZW5cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgY29uc3QgaGFzaF9yZXNwb25zZTogQXhpb3NSZXNwb25zZSA9IGF3YWl0IGF4aW9zKGhhc2hfY29uZmlnKS5jYXRjaChlcnIgPT4gUHJvbWlzZS5yZWplY3QoZXJyLnJlc3BvbnNlICYmIGVyci5yZXNwb25zZS5zdGF0dXMgPCA1MDAgPyBuZXcgV2ViU2VydmljZUVycm9yKGVyci5yZXNwb25zZS5kYXRhKSA6IGVycikpO1xyXG4gICAgICAgICAgICAgICAgT2JqZWN0LmFzc2lnbih0cmFuc2FjdGlvbl9yZXNwb25zZS5kYXRhLml0ZW1zW3ldLCB7XHJcbiAgICAgICAgICAgICAgICAgICAgZGV0YWlsczogaGFzaF9yZXNwb25zZS5kYXRhLFxyXG4gICAgICAgICAgICAgICAgICAgIGRpcmVjdGlvbjogaW5wdXRzLmRpcmVjdGlvbixcclxuICAgICAgICAgICAgICAgICAgICBpZDogYXNzZXQgKyAnOicgKyB0cmFuc2FjdGlvbl9yZXNwb25zZS5kYXRhLml0ZW1zW3ldLnRyYW5zYWN0aW9uSGFzaCxcclxuICAgICAgICAgICAgICAgICAgICBzaXJlbkRlbm9ybUlucHV0QWRkcmVzczogW10sXHJcbiAgICAgICAgICAgICAgICAgICAgc2lyZW5EZW5vcm1PdXRwdXRBZGRyZXNzOiBbXVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBhID0gMDsgYSA8IGhhc2hfcmVzcG9uc2UuZGF0YS50cmFjZXMubGVuZ3RoOyBhKyspIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgYiA9IDA7IGIgPCBoYXNoX3Jlc3BvbnNlLmRhdGEudHJhY2VzW2FdLmlucHV0cy5sZW5ndGg7IGIrKykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJhbnNhY3Rpb25fcmVzcG9uc2UuZGF0YS5pdGVtc1t5XS5zaXJlbkRlbm9ybUlucHV0QWRkcmVzcy5wdXNoKGFzc2V0ICsgJzonICsgaGFzaF9yZXNwb25zZS5kYXRhLnRyYWNlc1thXS5pbnB1dHNbYl0uYWRkcmVzcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgYyA9IDA7IGMgPCBoYXNoX3Jlc3BvbnNlLmRhdGEudHJhY2VzW2FdLm91dHB1dHMubGVuZ3RoOyBjKyspIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyYW5zYWN0aW9uX3Jlc3BvbnNlLmRhdGEuaXRlbXNbeV0uc2lyZW5EZW5vcm1PdXRwdXRBZGRyZXNzLnB1c2goYXNzZXQgKyAnOicgKyBoYXNoX3Jlc3BvbnNlLmRhdGEudHJhY2VzW2FdLm91dHB1dHNbY10uYWRkcmVzcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9IGNhdGNoIChlcnJvcikgeyAvKiBlcnJvciBoYW5kbGluZyBjYW4gYmUgZG9uZSBoZXJlIGlmIHJlcXVpcmVkICovIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBvdmVyYWxsUmVzdWx0cy5wdXNoLmFwcGx5KG92ZXJhbGxSZXN1bHRzLCB0cmFuc2FjdGlvbl9yZXNwb25zZS5kYXRhLml0ZW1zKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHRyYW5zYWN0aW9uOiBvdmVyYWxsUmVzdWx0cyxcclxuICAgICAgICAgICAgcGFnaW5hdGlvbjogW3tcclxuICAgICAgICAgICAgICAgIHRvdGFscmVzdWx0czogb3ZlcmFsbFJlc3VsdHMubGVuZ3RoLFxyXG4gICAgICAgICAgICAgICAgbmV4dFBhZ2U6IG92ZXJhbGxOZXh0UGFnZVxyXG4gICAgICAgICAgICB9XVxyXG4gICAgICAgIH07XHJcbiAgICB9XHJcbn1cclxuIl19
