"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const web_service_interface_1 = require("@sirensolutions/web-service-interface");
const axios_1 = require("axios");
const cryptoRegexPatterns = {
    'BTC': '^(bc1|[13])[a-zA-HJ-NP-Z0-9]{25,39}$',
    'ETH': '^(?:0x)?[a-fA-F0-9]{40,42}$',
    'XRP': '^r[0-9a-zA-Z]{24,34}$',
    'BNB': '^bnb[0-9a-zA-Z]{38}$',
    'ADA': '^Ae2tdPwUPEYy{44}$',
    'SOL': '^So[1-9][0-9a-zA-Z]{48}$',
    'DOGE': '^D[0-9a-fA-F]{32}$',
    'TRX': '^T[0-9a-fA-F]{33}$',
    'LTC': '^L[a-km-zA-HJ-NP-Z1-9]{26,33}$',
    'DOT': '^1[a-zA-Z0-9]{31}$',
    'LINK': '^0x[a-fA-F0-9]{40}$',
    'XLM': '^G[A-Z0-9]{55}$',
    'XMR': '^4[0-9A-Za-z]{94}$',
    'ATOM': '^cosmos1[a-z0-9]{38}$',
};
class ClusterObservations extends web_service_interface_1.ServiceDefinition {
    constructor() {
        super(...arguments);
        this.name = 'cluster_observations';
        this.inputSchema = {
            address: { type: 'text', required: true },
            asset: { type: 'text', required: false },
            startTime: { type: 'date', required: false },
            endTime: { type: 'date', required: false }
        };
        this.outputConfiguration = {
            observation: {
                'lat': 'long',
                'long': 'long',
                'timestamp': 'date',
                'geo_location': 'geo_point',
                'ipAddress': 'keyword',
                'port': 'keyword'
            }
        };
    }
    inferAssetType(address) {
        return Object.keys(cryptoRegexPatterns).filter(asset => {
            return new RegExp(cryptoRegexPatterns[asset]).test(address);
        });
    }
    async invoke(inputs) {
        const matchedAssets = inputs.asset ? [inputs.asset] : this.inferAssetType(inputs.address);
        let overallResults = [];
        for (const asset of matchedAssets) {
            let obs_url = `https://iapi.chainalysis.com/observations/clusters/${inputs.address}/${asset}?`;
            if (inputs.startTime) {
                obs_url = obs_url + `&startTime=${inputs.startTime}`;
            }
            if (inputs.endTime) {
                obs_url = obs_url + `&endTime=${inputs.endTime}`;
            }
            const obs_config = {
                method: 'get',
                url: obs_url,
                headers: {
                    'Accept': 'application/json',
                    'token': this.config.token
                }
            };
            const obs_response = await axios_1.default(obs_config).catch(err => Promise.reject(err.response && err.response.status < 500 ? new web_service_interface_1.WebServiceError(err.response.data) : err));
            for (let y = 0; y < obs_response.data.observations.length; y++) {
                let denormAddress = [];
                denormAddress.push(`${asset}:${obs_response.data.observations[y].walletRootAddress}`);
                denormAddress.push(`${asset}:${obs_response.data.address}`);
                denormAddress.push(`${asset}:${obs_response.data.rootAddress}`);
                Object.assign(obs_response.data.observations[y], {
                    sirenDenormAddress: ([...new Set(denormAddress)]),
                    id: obs_response.data.observations[y].walletRootAddress + ':' + obs_response.data.observations[y].timestamp,
                    address: obs_response.data.observations[y].walletRootAddress,
                    rootAddress: obs_response.data.rootAddress,
                    geo_location: obs_response.data.observations[y].lat + ',' + obs_response.data.observations[y].long
                });
                overallResults.push(obs_response.data.observations[y]);
            }
        }
        return {
            observation: overallResults
        };
    }
}
exports.default = ClusterObservations;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9DbHVzdGVyT2JzZXJ2YXRpb25zLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsaUZBQStJO0FBQy9JLGlDQUFpRTtBQUVqRSxNQUFNLG1CQUFtQixHQUFHO0lBQ3hCLEtBQUssRUFBRSxzQ0FBc0M7SUFDN0MsS0FBSyxFQUFFLDZCQUE2QjtJQUNwQyxLQUFLLEVBQUUsdUJBQXVCO0lBQzlCLEtBQUssRUFBRSxzQkFBc0I7SUFDN0IsS0FBSyxFQUFFLG9CQUFvQjtJQUMzQixLQUFLLEVBQUUsMEJBQTBCO0lBQ2pDLE1BQU0sRUFBRSxvQkFBb0I7SUFDNUIsS0FBSyxFQUFFLG9CQUFvQjtJQUMzQixLQUFLLEVBQUUsZ0NBQWdDO0lBQ3ZDLEtBQUssRUFBRSxvQkFBb0I7SUFDM0IsTUFBTSxFQUFFLHFCQUFxQjtJQUM3QixLQUFLLEVBQUUsaUJBQWlCO0lBQ3hCLEtBQUssRUFBRSxvQkFBb0I7SUFDM0IsTUFBTSxFQUFFLHVCQUF1QjtDQUVsQyxDQUFDO0FBQ0YsTUFBcUIsbUJBQW9CLFNBQVEseUNBQWlCO0lBQWxFOztRQUNhLFNBQUksR0FBRyxzQkFBc0IsQ0FBQztRQUM5QixnQkFBVyxHQUFnQjtZQUNoQyxPQUFPLEVBQUUsRUFBRSxJQUFJLEVBQUUsTUFBTSxFQUFFLFFBQVEsRUFBRSxJQUFJLEVBQUU7WUFDekMsS0FBSyxFQUFFLEVBQUUsSUFBSSxFQUFFLE1BQU0sRUFBRSxRQUFRLEVBQUUsS0FBSyxFQUFFO1lBQ3hDLFNBQVMsRUFBRSxFQUFFLElBQUksRUFBRSxNQUFNLEVBQUUsUUFBUSxFQUFFLEtBQUssRUFBRTtZQUM1QyxPQUFPLEVBQUUsRUFBRSxJQUFJLEVBQUUsTUFBTSxFQUFFLFFBQVEsRUFBRSxLQUFLLEVBQUU7U0FDN0MsQ0FBQztRQUNPLHdCQUFtQixHQUF3QjtZQUNoRCxXQUFXLEVBQUU7Z0JBQ1QsS0FBSyxFQUFHLE1BQU07Z0JBQ2QsTUFBTSxFQUFFLE1BQU07Z0JBQ2QsV0FBVyxFQUFFLE1BQU07Z0JB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LGlCQUFpQixHQUFHLEdBQUcsR0FBRyxZQUFZLENBQUMsSUFBSSxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUMsQ0FBQyxTQUFTO29CQUMzRyxPQUFPLEVBQUUsWUFBWSxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDLENBQUMsaUJBQWlCO29CQUM1RCxXQUFXLEVBQUUsWUFBWSxDQUFDLElBQUksQ0FBQyxXQUFXO29CQUMxQyxZQUFZLEVBQUUsWUFBWSxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxHQUFHLEdBQUcsR0FBRyxZQUFZLENBQUMsSUFBSSxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJO2lCQUNyRyxDQUFDLENBQUE7Z0JBQ0YsY0FBYyxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO2FBQzFEO1NBQ0o7UUFFRCxPQUFPO1lBQ0gsV0FBVyxFQUFFLGNBQWM7U0FDOUIsQ0FBQTtJQUNMLENBQUM7Q0FDSjtBQW5FRCxzQ0FtRUMiLCJmaWxlIjoic3JjL0NsdXN0ZXJPYnNlcnZhdGlvbnMuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBEYXRhSW5kZXhSZXN1bHRzLCBJbnB1dFNjaGVtYSwgT3V0cHV0Q29uZmlndXJhdGlvbiwgU2VydmljZURlZmluaXRpb24sIFdlYlNlcnZpY2VFcnJvciB9IGZyb20gJ0BzaXJlbnNvbHV0aW9ucy93ZWItc2VydmljZS1pbnRlcmZhY2UnO1xyXG5pbXBvcnQgYXhpb3MsIHsgQXhpb3NSZXF1ZXN0Q29uZmlnLCBBeGlvc1Jlc3BvbnNlIH0gZnJvbSAnYXhpb3MnO1xyXG5cclxuY29uc3QgY3J5cHRvUmVnZXhQYXR0ZXJucyA9IHtcclxuICAgICdCVEMnOiAnXihiYzF8WzEzXSlbYS16QS1ISi1OUC1aMC05XXsyNSwzOX0kJywgLy8gQml0Y29pbiAoQlRDKSBpbmNsdWRpbmcgYmVjaDMyIGFkZHJlc3Nlc1xyXG4gICAgJ0VUSCc6ICdeKD86MHgpP1thLWZBLUYwLTldezQwLDQyfSQnLCAvLyBFdGhlcmV1bVxyXG4gICAgJ1hSUCc6ICdeclswLTlhLXpBLVpdezI0LDM0fSQnLCAvLyBSaXBwbGVcclxuICAgICdCTkInOiAnXmJuYlswLTlhLXpBLVpdezM4fSQnLCAvLyBCaW5hbmNlIENvaW5cclxuICAgICdBREEnOiAnXkFlMnRkUHdVUEVZeXs0NH0kJywgLy8gQ2FyZGFub1xyXG4gICAgJ1NPTCc6ICdeU29bMS05XVswLTlhLXpBLVpdezQ4fSQnLCAvLyBTb2xhbmFcclxuICAgICdET0dFJzogJ15EWzAtOWEtZkEtRl17MzJ9JCcsIC8vIERvZ2Vjb2luXHJcbiAgICAnVFJYJzogJ15UWzAtOWEtZkEtRl17MzN9JCcsIC8vIFRyb25cclxuICAgICdMVEMnOiAnXkxbYS1rbS16QS1ISi1OUC1aMS05XXsyNiwzM30kJywgLy8gTGl0ZWNvaW5cclxuICAgICdET1QnOiAnXjFbYS16QS1aMC05XXszMX0kJywgLy8gUG9sa2Fkb3RcclxuICAgICdMSU5LJzogJ14weFthLWZBLUYwLTldezQwfSQnLCAvLyBDaGFpbmxpbmtcclxuICAgICdYTE0nOiAnXkdbQS1aMC05XXs1NX0kJywgLy8gU3RlbGxhciBMdW1lbnNcclxuICAgICdYTVInOiAnXjRbMC05QS1aYS16XXs5NH0kJywgLy8gTW9uZXJvXHJcbiAgICAnQVRPTSc6ICdeY29zbW9zMVthLXowLTldezM4fSQnLCAvLyBDb3Ntb3NcclxuICAgIC8vIEFkZCBtb3JlIHBhdHRlcm5zIGhlcmUgZm9yIG90aGVyIGNyeXB0b2N1cnJlbmNpZXNcclxufTtcclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgQ2x1c3Rlck9ic2VydmF0aW9ucyBleHRlbmRzIFNlcnZpY2VEZWZpbml0aW9uIHtcclxuICAgIHJlYWRvbmx5IG5hbWUgPSAnY2x1c3Rlcl9vYnNlcnZhdGlvbnMnO1xyXG4gICAgcmVhZG9ubHkgaW5wdXRTY2hlbWE6IElucHV0U2NoZW1hID0ge1xyXG4gICAgICAgIGFkZHJlc3M6IHsgdHlwZTogJ3RleHQnLCByZXF1aXJlZDogdHJ1ZSB9LFxyXG4gICAgICAgIGFzc2V0OiB7IHR5cGU6ICd0ZXh0JywgcmVxdWlyZWQ6IGZhbHNlIH0sXHJcbiAgICAgICAgc3RhcnRUaW1lOiB7IHR5cGU6ICdkYXRlJywgcmVxdWlyZWQ6IGZhbHNlIH0sXHJcbiAgICAgICAgZW5kVGltZTogeyB0eXBlOiAnZGF0ZScsIHJlcXVpcmVkOiBmYWxzZSB9XHJcbiAgICB9O1xyXG4gICAgcmVhZG9ubHkgb3V0cHV0Q29uZmlndXJhdGlvbjogT3V0cHV0Q29uZmlndXJhdGlvbiA9IHtcclxuICAgICAgICBvYnNlcnZhdGlvbjoge1xyXG4gICAgICAgICAgICAnbGF0JyA6ICdsb25nJyxcclxuICAgICAgICAgICAgJ2xvbmcnOiAnbG9uZycsXHJcbiAgICAgICAgICAgICd0aW1lc3RhbXAnOiAnZGF0ZScsXHJcbiAgICAgICAgICAgICdnZW9fbG9jYXRpb24nOiAnZ2VvX3BvaW50JyxcclxuICAgICAgICAgICAgJ2lwQWRkcmVzcyc6ICdrZXl3b3JkJyxcclxuICAgICAgICAgICAgJ3BvcnQnOiAna2V5d29yZCdcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG5cclxuICAgIHByaXZhdGUgaW5mZXJBc3NldFR5cGUoYWRkcmVzczogc3RyaW5nKTogc3RyaW5nW10ge1xyXG4gICAgICAgIHJldHVybiBPYmplY3Qua2V5cyhjcnlwdG9SZWdleFBhdHRlcm5zKS5maWx0ZXIoYXNzZXQgPT4ge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFJlZ0V4cChjcnlwdG9SZWdleFBhdHRlcm5zW2Fzc2V0XSkudGVzdChhZGRyZXNzKTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBhc3luYyBpbnZva2UoaW5wdXRzOiB7XHJcbiAgICAgICAgYWRkcmVzczogc3RyaW5nLFxyXG4gICAgICAgIGFzc2V0Pzogc3RyaW5nLFxyXG4gICAgICAgIHN0YXJ0VGltZTogc3RyaW5nLFxyXG4gICAgICAgIGVuZFRpbWU6IHN0cmluZ1xyXG4gICAgfSk6IFByb21pc2U8RGF0YUluZGV4UmVzdWx0cz4ge1xyXG4gICAgICAgIGNvbnN0IG1hdGNoZWRBc3NldHMgPSBpbnB1dHMuYXNzZXQgPyBbaW5wdXRzLmFzc2V0XSA6IHRoaXMuaW5mZXJBc3NldFR5cGUoaW5wdXRzLmFkZHJlc3MpO1xyXG4gICAgICAgIGxldCBvdmVyYWxsUmVzdWx0czogb2JqZWN0W10gPSBbXTtcclxuXHJcbiAgICAgICAgZm9yIChjb25zdCBhc3NldCBvZiBtYXRjaGVkQXNzZXRzKSB7XHJcbiAgICAgICAgICAgIGxldCBvYnNfdXJsID0gYGh0dHBzOi8vaWFwaS5jaGFpbmFseXNpcy5jb20vb2JzZXJ2YXRpb25zL2NsdXN0ZXJzLyR7aW5wdXRzLmFkZHJlc3N9LyR7YXNzZXR9P2BcclxuICAgICAgICAgICAgaWYgKGlucHV0cy5zdGFydFRpbWUpIHtvYnNfdXJsID0gb2JzX3VybCArIGAmc3RhcnRUaW1lPSR7aW5wdXRzLnN0YXJ0VGltZX1gfVxyXG4gICAgICAgICAgICBpZiAoaW5wdXRzLmVuZFRpbWUpIHtvYnNfdXJsID0gb2JzX3VybCArIGAmZW5kVGltZT0ke2lucHV0cy5lbmRUaW1lfWB9XHJcbiAgICAgICAgICAgIGNvbnN0IG9ic19jb25maWc6IEF4aW9zUmVxdWVzdENvbmZpZyA9IHtcclxuICAgICAgICAgICAgICAgIG1ldGhvZDogJ2dldCcsXHJcbiAgICAgICAgICAgICAgICB1cmw6IG9ic191cmwsXHJcbiAgICAgICAgICAgICAgICBoZWFkZXJzOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgJ0FjY2VwdCc6ICdhcHBsaWNhdGlvbi9qc29uJyxcclxuICAgICAgICAgICAgICAgICAgICAndG9rZW4nOiB0aGlzLmNvbmZpZy50b2tlblxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICBjb25zdCBvYnNfcmVzcG9uc2U6IEF4aW9zUmVzcG9uc2UgPSBhd2FpdCBheGlvcyhvYnNfY29uZmlnKS5jYXRjaChlcnIgPT4gUHJvbWlzZS5yZWplY3QoZXJyLnJlc3BvbnNlICYmIGVyci5yZXNwb25zZS5zdGF0dXMgPCA1MDAgPyBuZXcgV2ViU2VydmljZUVycm9yKGVyci5yZXNwb25zZS5kYXRhKSA6IGVycikpO1xyXG4gICAgICAgICAgICBmb3IgKGxldCB5ID0gMDsgeSA8IG9ic19yZXNwb25zZS5kYXRhLm9ic2VydmF0aW9ucy5sZW5ndGg7IHkrKykge1xyXG4gICAgICAgICAgICAgICAgbGV0IGRlbm9ybUFkZHJlc3M6IHN0cmluZ1tdID0gW107XHJcbiAgICAgICAgICAgICAgICBkZW5vcm1BZGRyZXNzLnB1c2goYCR7YXNzZXR9OiR7b2JzX3Jlc3BvbnNlLmRhdGEub2JzZXJ2YXRpb25zW3ldLndhbGxldFJvb3RBZGRyZXNzfWApXHJcbiAgICAgICAgICAgICAgICBkZW5vcm1BZGRyZXNzLnB1c2goYCR7YXNzZXR9OiR7b2JzX3Jlc3BvbnNlLmRhdGEuYWRkcmVzc31gKVxyXG4gICAgICAgICAgICAgICAgZGVub3JtQWRkcmVzcy5wdXNoKGAke2Fzc2V0fToke29ic19yZXNwb25zZS5kYXRhLnJvb3RBZGRyZXNzfWApXHJcbiAgICAgICAgICAgICAgICBPYmplY3QuYXNzaWduKG9ic19yZXNwb25zZS5kYXRhLm9ic2VydmF0aW9uc1t5XSwge1xyXG4gICAgICAgICAgICAgICAgICAgIHNpcmVuRGVub3JtQWRkcmVzczogKFsuLi4gbmV3IFNldChkZW5vcm1BZGRyZXNzKV0pLFxyXG4gICAgICAgICAgICAgICAgICAgIGlkOiBvYnNfcmVzcG9uc2UuZGF0YS5vYnNlcnZhdGlvbnNbeV0ud2FsbGV0Um9vdEFkZHJlc3MgKyAnOicgKyBvYnNfcmVzcG9uc2UuZGF0YS5vYnNlcnZhdGlvbnNbeV0udGltZXN0YW1wLFxyXG4gICAgICAgICAgICAgICAgICAgIGFkZHJlc3M6IG9ic19yZXNwb25zZS5kYXRhLm9ic2VydmF0aW9uc1t5XS53YWxsZXRSb290QWRkcmVzcyxcclxuICAgICAgICAgICAgICAgICAgICByb290QWRkcmVzczogb2JzX3Jlc3BvbnNlLmRhdGEucm9vdEFkZHJlc3MsXHJcbiAgICAgICAgICAgICAgICAgICAgZ2VvX2xvY2F0aW9uOiBvYnNfcmVzcG9uc2UuZGF0YS5vYnNlcnZhdGlvbnNbeV0ubGF0ICsgJywnICsgb2JzX3Jlc3BvbnNlLmRhdGEub2JzZXJ2YXRpb25zW3ldLmxvbmdcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICBvdmVyYWxsUmVzdWx0cy5wdXNoKG9ic19yZXNwb25zZS5kYXRhLm9ic2VydmF0aW9uc1t5XSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIG9ic2VydmF0aW9uOiBvdmVyYWxsUmVzdWx0c1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG4iXX0=
